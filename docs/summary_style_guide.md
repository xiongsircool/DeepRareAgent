# summary_style 自定义报告格式使用指南

## 🎯 功能说明

`summary_style` 是 `MainGraphState` 中的一个字段，允许你用**自然语言描述**想要的报告格式。汇总智能体会根据这个描述生成符合要求的诊断报告。

## [LIST] 基本用法

### 方式1：使用默认格式

```python
state = {
    "summary_style": ""  # 空字符串或不设置
}
```

**效果**：生成标准的临床诊断报告，包含9个标准章节。

### 方式2：自定义格式

```python
state = {
    "summary_style": """
报告格式要求（简洁版）：

1. **诊断结论**：直接给出明确诊断
2. **关键依据**（3-5条）：列出最重要的诊断依据  
3. **必做检查**（2-3项）：列出确诊必需的检查
4. **治疗建议**：简要说明治疗方案
5. **注意事项**：患者需要知道的重要信息

要求：简洁明了，总长度控制在1000字以内
"""
}
```

**效果**：按照你描述的结构和风格生成报告。

## 🎨 预设格式示例

### 1. 简洁格式（适合快速诊疗）

```python
summary_style = """
1. **诊断结论**（1段）：直接给出明确诊断
2. **关键依据**（3-5条）：列出最重要的诊断依据
3. **必做检查**（2-3项）：列出确诊必需的检查项目
4. **治疗建议**（1段）：简要说明治疗方案
5. **注意事项**（3-5条）：患者需要知道的重要信息

要求：简洁明了，总长度控制在1000字以内
"""
```

### 2. 患者友好版（适合患者阅读）

```python
summary_style = """
### 您的诊断结果
[用通俗语言说明诊断，避免复杂医学术语]

### 这是什么病？
[用简单的语言解释疾病是什么、为什么会得这个病]

### 为什么是这个诊断？
[用患者能理解的方式说明诊断依据]

### 接下来要做什么？
[明确告诉患者需要做哪些检查，用什么方法治疗]

### 日常生活中要注意什么？
[生活建议、饮食注意事项、什么情况需要立即就医]

### 常见问题解答
Q: 这个病严重吗？
A: [回答]

Q: 可以治愈吗？
A: [回答]

要求：语言通俗易懂，避免使用复杂医学术语
"""
```

### 3. 学术论文格式（适合科研/发表）

```python  
summary_style = """
## Abstract
[疾病诊断的简要摘要，100字以内]

## Introduction  
[病例背景介绍]

## Clinical Presentation
[临床表现详细描述]

## Differential Diagnosis
[鉴别诊断分析，每个诊断需列出支持和反对证据]

## Final Diagnosis
[最终诊断及诊断依据]

## Management Plan
[治疗和管理方案]

## Discussion
[病例讨论和文献回顾]

## References
[如有引用证据，请使用 <ref>N</ref> 标注]

要求：使用学术化语言，结构严谨
"""
```

### 4. 临床病历格式（适合医院归档）

```python
summary_style = """
入院记录

患者姓名：[编号]
入院时间：[日期]  
主诉：[主要症状]

现病史：
[详细病史]

初步诊断：
主要诊断：[诊断名称]
诊断依据：
1. [依据1]
2. [依据2]

诊疗计划：
1. 完善检查：[列出]
2. 治疗方案：[列出]
3. 护理要点：[列出]

医师签名：[AI生成]
日期：[当前日期]

要求：符合医院病历书写规范
"""
```

### 5. 中英双语格式（适合国际交流）

```python
summary_style = """
## 诊断结论 / Diagnosis
[中文诊断] / [English Diagnosis]

## 诊断依据 / Diagnostic Criteria  
1. [中文依据1] / [English Evidence 1]
2. [中文依据2] / [English Evidence 2]

## 治疗建议 / Treatment Recommendations
[中文治疗方案] / [English Treatment Plan]

## 注意事项 / Important Notes
[中文注意事项] / [English Precautions]

要求：每个章节都提供中英双语对照
"""
```

## 💡 编写技巧

### 1. 使用清晰的章节结构

[PASS] 好的示例：
```
1. **诊断结论**：[要求]
2. **诊断依据**：[要求]
3. **治疗方案**：[要求]
```

[FAIL] 不好的示例：
```
请生成一份报告，包含诊断和治疗
```

### 2. 明确内容要求

[PASS] 好的示例：
```
**诊断结论**（1段，50字以内）：直接给出明确诊断，包含OMIM编码
```

[FAIL] 不好的示例：
```
**诊断结论**：写诊断
```

### 3. 指定语言风格

```
要求：
- 使用通俗易懂的语言，避免复杂医学术语
- 每个医学术语首次出现时加注解释
```

### 4. 控制报告长度

```
要求：
- 总长度控制在1000字以内
- 每个章节不超过200字
```

### 5. 指定特殊格式

```
要求：
- 使用 Markdown 格式
- 重要信息用 [WARN] 标注
- 检查项目用 [PASS] 标注
- 可使用 <ref>N</ref> 引用证据
```

## 🎯 应用场景

| 场景 | 推荐格式 | 说明 |
|------|---------|------|
| **临床诊疗** | 默认格式 | 专业、完整、规范 |
| **患者沟通** | 患者友好版 | 通俗易懂、问答形式 |
| **科研发表** | 学术论文格式 | 结构化、文献引用 |
| **医院归档** | 临床病历格式 | 符合病历规范 |
| **国际会诊** | 中英双语格式 | 方便跨语言交流 |
| **快速诊疗** | 简洁格式 | 抓重点、省时间 |

## [TOOL] 在代码中使用

### 直接设置

```python
from DeepRareAgent.main_graph import app

state = {
    "messages": [...],
    "summary_style": """
    报告格式要求：
    1. 诊断结论
    2. 治疗建议
    3. 注意事项
    """
}

result = app.invoke(state)
final_report = result["final_report"]
```

### 动态选择

```python
def get_summary_style(audience: str) -> str:
    """根据受众选择报告格式"""
    styles = {
        "patient": patient_friendly_style,
        "doctor": "",  # 默认格式
        "researcher": academic_style,
        "hospital": medical_record_style
    }
    return styles.get(audience, "")

summary_style = get_summary_style("patient")
state["summary_style"] = summary_style
```

## [WARN] 注意事项

1. **LLM 理解能力**
   - 描述要清晰具体
   - 避免模糊的表述"可能"、"或许"
   
2. **格式复杂度**
   - 不要过于复杂的嵌套结构
   - 章节数量建议在10个以内
   
3. **与系统提示词的关系**
   - `summary_style` 是对**格式**的要求
   - 系统提示词定义了**角色**和**基本原则**
   - 两者互补，不冲突

4. **证据引用**
   - 无论什么格式，都可以使用 `<ref>N</ref>` 引用证据
   - 证据详情会自动追加到报告末尾

## 📚 更多示例

查看完整示例：
```bash
python examples/summary_style_examples.py
```

## 🎨 自定义格式模板

复制以下模板，根据需要修改：

```python
summary_style = """
报告格式要求（自定义）：

## 第一部分：[章节名称]
[内容要求描述]

## 第二部分：[章节名称]
[内容要求描述]

## 第三部分：[章节名称]
[内容要求描述]

要求：
- [语言风格]
- [长度要求]
- [特殊格式]
"""
```

---

**提示**：`summary_style` 为空时，使用默认的专业临床诊断报告格式，适用于大多数场景。
